!function t(n,e,i){function r(o,s){if(!e[o]){if(!n[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=e[o]={exports:{}};n[o][0].call(c.exports,function(t){var e=n[o][1][t];return r(e?e:t)},c,c.exports,t,n,e,i)}return e[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,n,e){var i,r={},a=this,o=function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=function(t){return t.childrenName||"children"};"undefined"!=typeof e?("undefined"!=typeof n&&n.exports&&(e=n.exports=r),e.t=r):a.t=r,r.bfs=function(t){var n,e,i,r,a,u,l,c=3===arguments.length,d=c?arguments[1]:{},f=o(t)?t.slice(0):[t],h=[void 0],p=s(d);if(null==t)return t;for(arguments.length>=3?(d=arguments[1],i=arguments[2]):(d={},i=arguments[1]);f.length&&(n=f.shift(),u=h.shift(),e={},i.call(n,n,u,e),!e.stop);)for(l=n[p]||[],r=0,a=l.length;r<a;r++)f.push(l[r]),h.push(n);return t},r.dfs=function(t){var n,e,r,a,u,l,c=3===arguments.length,d=o(t)?t.slice(0).reverse():[t],f=c?arguments[1]:{},h=arguments[c?2:1],p=[],b=s(f);if("undefined"!=typeof d[0]||1!==d.length){if("post"===f.order)return l=i(d,f,h),o(t)?l:l[0];for(u=d.length-1;u>=0;u--)p.push(void 0);for(;d.length>0&&(n=d.pop(),e=p.pop(),a={},h.call(n,n,e,a),!a.stop);)for(r=n&&n[b]?n[b]:[],u=a.cutoff?-1:r.length-1;u>=0;u--)d.push(r[u]),p.push(n);return t}},r.map=function(){var t=arguments[0],n=3===arguments.length,e=n?arguments[1]:{},i=e.filter,a=arguments[n?2:1],u=o(t)?[]:void 0,l=function(t){return t[t.length-1]},c=[],d=s(e);return r.dfs(t,e,function(n,e,r){var s=l(c),f=a(n,s?s.ret:void 0);return i&&!f?(r.cutoff=!0,void(s&&n===l(s.n[d])&&(c.pop(),s.ret[d]&&!s.ret[d].length&&delete s.ret[d]))):(e?(s.ret[d].push(f),n===l(s.n[d])&&(c.pop(),s.ret[d]&&!s.ret[d].length&&delete s.ret[d])):o(t)?u.push(f):u=f,void(n[d]&&n[d].length&&(f[d]=[],c.push({n:n,ret:f}))))}),u},r.filter=function(t){var n=3===arguments.length,e=arguments[n?2:1],i=n?arguments[1]:{};return r.map(t,{filter:!0,childrenName:i.childrenName},e)},r.stroll=function(t,n){var e,i,a=4===arguments.length,u=arguments[a?3:2],l=a?arguments[2]:{},c=s(l),d=o(n)?n.slice(0).reverse():[n],f=function(t){return"undefined"==typeof t?0:t.length};r.dfs(t,l,function(t,n,r){if(i=d.pop(),u(t,i),t&&i&&f(t[c])===f(i[c]))for(e=(i[c]||[]).length-1;e>=0;e--)d.push(i[c][e]);else r.cutoff=!0})},r.find=function(t){var n,e=3===arguments.length,i=arguments[e?2:1],a=e?arguments[1]:{};return r.dfs(t,a,function(t,e,r){i.call(t,t,e)&&(r.stop=!0,n=this)}),n},i=function(t,n,e){for(var i,r,a,o,u=function(t){return t[t.length-1]},l=[],c=[{node:t.pop(),index:0,ret:[]}],d=s(n);c.length;)i=u(c),o=i.node,o[d]&&o[d].length&&i.index<o[d].length?c.push({node:o[d][i.index++],index:0,ret:[]}):(a={},r=c[c.length-2],r?(r.ret.push(e.call(o,o,r.node,a,i.ret)),c.pop()):(l.push(e.call(o,o,void 0,a,i.ret)),c.pop(),t.length&&c.push({node:t.pop(),index:0,ret:[]})));return l},n.exports=r},{}],2:[function(t,n,e){(function(n){function e(t,n,e){e=e||getAbsoluteRoot();var i=0;return l.dfs(e,[],function(e,r,a){void 0!=e._count&&(e.count=e._count,e._count=void 0),n(e,t)?i+=e.count:(l.dfs(e,[],function(t,n,e){void 0!=t.count&&0!=t.count&&(t._count=t.count,t.count=0)}),a.cutoff=!0)}),e}function i(t){var n=t/1e5,e=n.toString()[1],i=parseInt(e);return t/1e6>=1?t=parseInt(t/1e6)+"."+i+"M":t/1e3>=1&&(t=Math.round(t/1e3)+"K"),t}var r=n.iobio||{};n.iobio=r;var a=[],o=[],s=t("./sunburst.d3.js"),u=t("./donut.d3.js"),l=t("../lib/t.js");$.fn.d3Click=function(){this.each(function(t,n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(e)})},n.iobio.donutSunburst=function(t,n){this.cmd,this.pieChartCallback=n,$(t).append("<div id='big-binner' class='results'><div id='b'></><div style='clear:both'></div></div>");var e=$("#big-binner");this.bigBinnerElem=e[0];var i=e.height(),r=i+120;e.css("width",r+"px"),e.css("height",i+"px"),e.css("left","calc(50% - "+r/2+"px)"),$("#big-binner #b").append("<svg id='big-binner-binner' viewbox='0 0 "+r+" "+i+"'  preserveAspectRatio='xMidYMid' style='margin-top:20px' ></svg>"),this.bigBinnerBinnerElem=$("#big-binner-binner")[0],$(t).append("<div id='main-viz' class='results'><div id='selected-name'>All</div><div id='viz'></div><div id='reads-viewed'><h4 id='total-reads'>Total <span id='bin'></span> Reads Classified: <span class='iobio-txt-color'></span></h4><div style='clear:both'></div></div></div>");var a=$("#main-viz");this.mainViz=a[0],$(t).append("<div id='no-results' style='display:none'><div>Oops there was an error</div><div>Please try again and make sure your file or url is valid</div></div>"),this.sunburstElem=$("#viz")[0];var r=i+12;a.css("width",r+"px"),a.css("height",i+"px"),a.css("left","calc(50% - "+r/2+"px)"),$(this.sunburstElem).append("<svg id='sunburst-chart' viewbox='0 0 "+r+" "+i+"'  preserveAspectRatio='xMidYMid' style='margin-top:20px' ></svg>"),$(this.sunburstElem).append("<div id='bar-chart'></div>"),$("#big-binner").css("visibility","hidden"),$("#main-viz").css("visibility","hidden")},n.iobio.donutSunburst.prototype.goObj=function(t){this.go(t,{data:!0})},n.iobio.donutSunburst.prototype.go=function(t,n){function e(t){$("#sunburst-spinner").css("display","none"),a=[],o=[];var n=0;if(void 0==t.binnerResult.phage&&(t.binnerResult.phage=0),Object.keys(t.binnerResult).forEach(function(e){if("unclassified"==e?a.push({name:"unknown",count:t.binnerResult[e]}):a.push({name:e,count:t.binnerResult[e]}),void 0!=t.classifierResult[e]){var i=t.classifierResult[e].count||0;o.push({name:e,count:i,type:"classified"}),o.push({name:e+"-binner",count:t.binnerResult[e]-i,type:"binner"})}else"unclassified"==e?o.push({name:"unknown-binner",count:t.binnerResult[e],type:"binner"}):o.push({name:e+"-binner",count:t.binnerResult[e],type:"binner"});n+=t.binnerResult[e]}),$("#reads-sampled .metric").html(i(n)),0==n||1==n&&t.binnerResult.unclassified)return n=0,r.options&&r.options.errorCallback&&r.options.errorCallback("NO RESULTS"),$("#iobio-viz #no-results").css("display","block"),void $("#iobio-viz").css("display","block");$("#no-results").css("display","none");var e={name:"root",id:"root",count:0,children:[]};Object.keys(t.classifierResult).forEach(function(n){if(void 0!=t.classifierResult[n].children)if(void 0==t.classifierResult[n].children[0].children){var i=t.classifierResult[n];e.children.push(i)}else{var i=t.classifierResult[n].children[0];"no rank:root"==i.name&&"no rank:cellular organisms"==i.children[0].name&&i.count>i.children[0].count&&(i.count=i.children[0].count),e.children.push(i)}var r=t.classifierResult[n].count||0;e.count+=r});var s=["human","viral","bacterial","fungal","ambiguous","unclassified","phage","phix"];if(s.forEach(function(n){var i=t.classifierResult[n]?t.classifierResult[n].count:void 0;e.children.forEach(function(t){t.bin==n&&(i=t.count)}),i=void 0==i?"":" ("+v(i)+")",$("."+n+"-binned-reads").html(v(t.binnerResult[n])+i)}),$("#reads-classified .metric").html(i(e.count)),$("#percent-reads-classified .metric").html(d3.format("%")(e.count/n)),r.rootData=JSON.parse(JSON.stringify(e)),"binner"==r.mode)$("#big-binner").css("visibility","visible"),$("#main-viz").css("visibility","hidden"),$("#sunburst-filters input").css("visibility","visible"),r.drawBigBinnerChart(a,o,{chartElem:r.bigBinnerBinnerElem});else{$("#big-binner").css("visibility","hidden"),$("#main-viz").css("visibility","visible"),$("#sunburst-filters input").css("visibility","hidden");var u,c=d3.select("#main-viz path").data()[0],d=treeToHash(c,"id");l.bfs(r.rootData,[],function(t,n,e){t.id==c.id&&t.bin==c.bin&&(u=t,l.bfs(u,[],function(t,n,e){void 0!=d[t.id]&&(t.x0=d[t.id].x0,t.dx0=d[t.id].dx0)}),e.stop=!0)});var f=$("#min-read-count-slider").val();if(f>1)r.filterCount(f,u);else{var h=d3.select(r.sunburstElem).select("svg").datum(u);r.sunburstChart(h,{transitionDuration:200})}var p=r.getBinRoot(u.bin);p=void 0==p?"":p.count,$("#total-reads .iobio-txt-color").html(p)}}n=n||{},this.ignoreData=!1;var r=this,c=this.sunburstElem;this.bigBinnerElem;$("#big-binner").css("visibility","hidden"),$("#main-viz").css("visibility","hidden"),r.mode="binner";var d=d3.format(",0f"),f=$("#big-binner-binner").height()/2,h=d3.scale.ordinal().domain(["bacterial","fungal","human","viral","unknown","ambiguous","phage","phix"]).range(["#e31b00","#0081f3","#003F78","#83338F","rgb(120,120,120)","#A7AAB3","#008C26","#06ac61"]);r.bigBinnerChart=u().radius(f-40).thickness(f).klass("binnerArc").click(function(t){r.toSunburst(t.name)}).color(function(t){return h(t.data.name)}).tooltip(function(t,n){var e=parseInt(t.value/n*1e3)/10;return t.data.name+" binned: "+d(t.value)+" ("+e+"%)"}),r.bigBinnerClassifiedChart=u().radius(f-20).thickness(20).klass("binnerClassArc").click(function(t){r.toSunburst(t.name)}).color(function(t){return"binner"==t.data.type?"white":h(t.data.name)}).tooltip(function(t){return t.data.name.split("-")[0]+" classified: "+d(t.value)}),r.binnerPie=d3.layout.pie().sort(function(t,n){return d3.ascending(t.name,n.name)}).value(function(t){return t.count});var p=$(c).find("svg").height(),b=$(c).find("svg").width();r.sunburstChart=s().width(b).height(p).clickBefore(function(t){r.updateBreadcrumbs(t),$("#selected-name").html("root"==t.name.split(":")[1]?t.children[0].name:t.name)}),r.options=n;var v=d3.format("0,000");e(t)},n.iobio.donutSunburst.prototype.drawBigBinnerChart=function(t,n,e){var i=this;$("#sunburst-top-controls").css("visibility","hidden"),e=e||{};var r=e.chartElem||"#big-binner-binner";t=t||a,n=n||o;var s=[];$.extend(!0,s,t);var u=[];$.extend(!0,u,n);var l=$("#sunburst-filters input:not(:checked)").toArray();l.forEach(function(t){var n=t.getAttribute("data-bin");s.forEach(function(t){t.name==n&&(t.count=0)}),u.forEach(function(t){t.name.split("-")[0]==n&&(t.count=0)})});var t=i.binnerPie(s),c=i.binnerPie(u),d=d3.select(r).selectAll(".binnerArc").data(t,function(t){return t.data.name});i.bigBinnerChart(d,e);var f=d3.select(r).selectAll(".binnerClassArc").data(c,function(t){return t.data.name});e.events=!1,i.bigBinnerClassifiedChart(f,e)},n.iobio.donutSunburst.prototype.resetCheckButtons=function(){$("#sunburst-filters .btn-group input").prop("checked",!0),$("#sunburst-filters button").prop("disabled",!1)},n.iobio.donutSunburst.prototype.resetCatButtons=function(){$("#sunburst-filters .btn-group").removeClass("disable-filter")},n.iobio.donutSunburst.prototype.toSunburst=function(t){var n=this,e=n.getBinRoot(t);if(void 0==e)return $("#no-classified-reads-modal #bin-category").html(t),$("#no-classified-reads-modal").modal("show"),void this.resetCatButtons();n.mode="sunburst",$("#min-abundance").css("visibility","visible");var i=d3.select("#viz svg").datum(e);n.sunburstChart.clear(),n.sunburstChart(i),this.initBreadcrumbs(e.children[0]),$("#sunburst-filters .btn-group:not(:has(.btn-"+t+"-filter))").addClass("disable-filter"),$("#sunburst-filters input").css("visibility","hidden");var r=[{name:"viral",count:0},{name:"unknown",count:0},{name:"fungal",count:0},{name:"bacterial",count:0},{name:"human",count:0},{name:"ambiguous",count:0},{name:"phage",count:0}];r.forEach(function(n){n.name==t&&(n.count=1)}),this.drawBigBinnerChart(r,r,{events:!0}),$("#selected-name").html(e.children[0].name),$("#big-binner-binner").on("binnerTransitionOver",function(){$("#big-binner").css("visibility","hidden"),$("#main-viz").css("visibility","visible"),$("#sunburst-top-controls").css("visibility","visible"),$(".composition").css("display","none"),$("#"+t+"-composition").css("display","block"),$("#total-reads #bin").html(t.charAt(0).toUpperCase()+t.slice(1));var e=n.getBinRoot(t);e=void 0==e?"":e.count,$("#total-reads .iobio-txt-color").html(e)})},n.iobio.donutSunburst.prototype.initBreadcrumbs=function(t){var n=this;0==$("#sunburst-breadcrumbs ul").length&&$("#sunburst-breadcrumbs").append("<ul></ul>"),$("#sunburst-breadcrumbs ul").html(""),$("#sunburst-breadcrumbs ul").append('<li> <span data-node="root" class="sunburst-breadcrumb">Pie Chart</span></li>'),$("#sunburst-breadcrumbs ul").append('<li><div class="extra-border"/><span class="sunburst-breadcrumb">'+t.name.split(":")[1]+"</span></li>"),$("#sunburst-breadcrumbs .sunburst-breadcrumb").on("click",function(){var t=this.getAttribute("data-node");n.selectCategory(t)})},n.iobio.donutSunburst.prototype.updateBreadcrumbs=function(t){var n=this,e=3;if($("#sunburst-breadcrumbs ul").html(""),"binner"!=n.mode&&(t=t||getCurrRoot(),void 0!=t)){"root"==t.name.split(":")[1]&&(t=t.children[0]);for(var i=[];void 0!=t;)i.unshift(t),t=t.parent;for(var r=(parseInt((i.length-1)/e)*e,0);r<i.length;r++){var a,o,s=i[r];"root"==s.name.split(":")[1]?(a="root",o="Pie Chart"):(a=s.id,o=s.name.split(":")[1]),$("#sunburst-breadcrumbs ul").append('<li><span class="sunburst-breadcrumb" data-node="'+a+'">'+o+'</span></li><li><span class="sunburst-breadcrumb-navigator">...</span></li>');var u=$("#sunburst-breadcrumbs ul").height(),l=$("#sunburst-breadcrumbs ul li").height();if($("#sunburst-breadcrumbs ul li").last().remove(),u>l){var c=$("#sunburst-breadcrumbs ul li").last();c.prevAll().css("display","none"),c.before('<li><span class="sunburst-breadcrumb-navigator" data-node="'+a+'" data-direction="back">...</span></li>')}}$("#sunburst-breadcrumbs ul li span").last().before('<div class="extra-border"/>'),$("#sunburst-breadcrumbs .sunburst-breadcrumb").on("click",function(){var t=this.getAttribute("data-node");n.selectCategory(t)}),$("#sunburst-breadcrumbs .sunburst-breadcrumb-navigator").on("click",function(){var t=this.getAttribute("data-direction"),n=$(this).parent();"back"==t?(n.prevAll().each(function(t,n){if(n.style.display="inline-block","..."==n.children[0].innerHTML)return!1}),n.nextAll().css("display","none"),this.setAttribute("data-direction","forward")):(n.nextAll().each(function(t,n){if(n.style.display="inline-block","..."==n.children[0].innerHTML)return!1}),n.prevAll().css("display","none"),this.setAttribute("data-direction","back"))})}},n.iobio.donutSunburst.prototype.selectCategory=function(t){var n=this;if("string"==typeof t||t instanceof String){var e=t;t=document.getElementById(t)}else var e=t.id;"root"==e?(n.pieChartCallback&&n.pieChartCallback(),n.mode="binner",$("#main-viz").css("visibility","hidden"),$("#big-binner").css("visibility","visible"),$("#sunburst-filters .btn-group:has(input:checked)").removeClass("disable-filter"),$("#sunburst-filters input").css("visibility","visible"),n.updateBreadcrumbs(),n.drawBigBinnerChart(null,null,{events:!1})):$(t).d3Click()},n.iobio.donutSunburst.prototype.filterCount=function(t,n){var i=this,r=e(t,function(t,n){return"root"==t.name||t.count>=parseInt(n)},n),a=d3.select("#viz svg").datum(r);i.sunburstChart(a,{pixelFilter:!0})},n.iobio.donutSunburst.prototype.getBinRoot=function(t){var n,e=this;return l.bfs(e.rootData,[],function(e,i,r){e.bin==t&&(n=e,r.stop=!0)}),n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/t.js":1,"./donut.d3.js":3,"./sunburst.d3.js":4}],3:[function(t,n,e){var i=function(){function t(t,f){function h(t){var n=d3.interpolate(this._current,t);return this._current=n(0),function(t){return s(n(t))}}function p(t,n){var e=0;t.each(function(){++e}).each("end",function(){--e||n.apply(this,arguments)})}l=$.extend(l,f),r=e+30,s=d3.svg.arc().outerRadius(e).innerRadius(e-i),n=t[0].parentNode;var b=n.getBoundingClientRect(),v=t.enter().append("g").attr("class",a).attr("transform","translate("+b.width/2+","+b.height/2+")"),m=v.append("path").attr("d",s).style("fill",function(t,n){return u(t)}).on("click",function(t){c(t.data)}).each(function(t){this._current=t});return o=0,t.data().forEach(function(t){o+=t.value}),d&&(m.on("mouseover",null),m.on("mouseover",function(t,n){iobioSunburstTooltipDiv.transition().duration(200).style("opacity",.9),iobioSunburstTooltipDiv.html(d(t,o)).style("left",d3.event.pageX+"px").style("text-align","left").style("top",d3.event.pageY-24+"px")}).on("mouseout",function(t){iobioSunburstTooltipDiv.transition().duration(500).style("opacity",0)})),t.exit().transition().remove(),l.text&&v.append("text").attr("transform",function(t){var n=s.centroid(t),e=n[0],i=n[1],a=Math.sqrt(e*e+i*i);return"translate("+e/a*r+","+i/a*r+")"}).attr("dy",".35em").attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t,n){var e=t.endAngle-t.startAngle;if(e>.08)return t.data.name[0].toUpperCase()+t.data.name.slice(1,t.data.name.length)}),t.select("text").transition().duration(200).attr("transform",function(t){var n=s.centroid(t),e=n[0],i=n[1],a=Math.sqrt(e*e+i*i);return"translate("+e/a*r+","+i/a*r+")"}).attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t,n){var e=t.endAngle-t.startAngle;return e<=.08?"":t.data.name[0].toUpperCase()+t.data.name.slice(1,t.data.name.length)}),t.select("path").transition().duration(400).attrTween("d",h).call(p,function(){l.events&&$(n).trigger({type:"binnerTransitionOver"})}),this}var n,e=90,i=7,r=e+30,a="arc",o=0,s=d3.svg.arc(),u=d3.scale.category20c(),l={text:!0},c=function(){},d=function(){};d3.format(",.1f"),d3.format(",0f");return t.radius=function(n){return arguments.length?(e=n,t):e},t.thickness=function(n){return arguments.length?(i=n,t):i},t.color=function(n){return arguments.length?(u=n,t):u},t.click=function(n){return arguments.length?(c=n,t):c},t.tooltip=function(n){return arguments.length?(d=n,t):d},t.klass=function(n){return arguments.length?(a=n,t):a},t};n.exports=i},{}],4:[function(t,n,e){function i(t,n){return d3.rebind(t,n,"sort","children","value"),t.nodes=t,t.links=l,t}function r(t,n){for(var e=[t];null!=(t=e.pop());)if(n(t),(r=t.children)&&(i=r.length))for(var i,r;--i>=0;)e.push(r[i])}function a(t,n){for(var e=[t],i=[];null!=(t=e.pop());)if(i.push(t),(a=t.children)&&(r=a.length))for(var r,a,o=-1;++o<r;)e.push(a[o]);for(;null!=(t=i.pop());)n(t)}function o(t){return t.children}function s(t){return t.value}function u(t,n){return n.value-t.value}function l(t){return d3.merge(t.map(function(t){return(t.children||[]).map(function(n){return{source:t,target:n}})}))}var c=function(){function t(t,g){function y(t,n){var e=x(t,n),i=d3.hcl(e),r=parseInt(i.l);return r>87&&"white"!=e.toString()?s:"white"}function x(t,e){if(0==e)return"white";if(n&&n.parent&&n.parent.id==t.id)return o.range()[0];var i=p(t.x)+(p(t.x+t.dx)-p(t.x))/2,r=n?t.depth-n.depth:t.depth;r<=3?brighter=0:brighter=r/6;var a=o(i+t.y);return d3.hcl(a).brighter(brighter)}function $(e){for(var i=e;i.parent;)i=i.parent;if(l=n.count,e.parent&&"root"==e.parent.name.split(":")[1]&&(e=e.parent),n=e,P.click){m(n);var r=d3.scale.linear().range([0,2*Math.PI]).domain([e.x,e.x+e.dx]),a=d3.scale.linear().range([e.y?20:0,c]).domain([e.y,1]);p=d3.scale.linear().domain([e.x,e.x+e.dx]).range([.075,.58]);for(var s,u=p(e.x)+p(e.dx)/2+e.y,g=[e];null!=(s=g.pop());){var k=p(s.x)+(p(s.x+s.dx)-p(s.x))/2+s.y;k>u&&(u=k),s.children&&(g=g.concat(s.children))}if(o.domain([p(e.x)+e.y,u]),P.pixelFilter)var B=t.select("g").selectAll(".path").data(b.nodes(i).filter(function(t){var n=Math.max(0,Math.min(2*Math.PI,r(t.x))),i=Math.max(0,Math.min(2*Math.PI,r(t.x+t.dx))),o=i-n,s=Math.max(0,a(t.y+t.dy)),u=o*s;return u>=1||t.y<=e.y}),function(t){return t.id});else var B=t.select("g").selectAll(".path").data(b.nodes(i),function(t){return t.id});B.exit().remove();var S=B.enter().append("g").attr("class","path");if(S.append("path").attr("d",h).attr("id",function(t){return P.idPrefix+t.id}).style("fill",x).on("click",$).on("mouseover",function(t,n){if(0!=n&&P.mouseover){iobioSunburstTooltipDiv.transition().duration(200).style("opacity",.9);var e=t.name.split(":")[0];"no rank"==e?iobioSunburstTooltipDiv.html(t.name.split(":")[1]+" - "+t.count):iobioSunburstTooltipDiv.html(t.name+" - "+t.count).style("left",d3.event.pageX+"px").style("text-align","left").style("top",d3.event.pageY-24+"px")}}).on("mouseout",function(t){iobioSunburstTooltipDiv.transition().duration(500).style("opacity",0)}).each(M),P.text){var R=S.append("text").attr("x",function(t){return 0}).attr("dy",function(t){return(f(t.y+t.dy)-f(t.y))/2}).attr("dx",function(t){var n=d(t.x),e=d(t.x+t.dx),i=e-n,r=f(t.y)+(f(t.y+t.dy)-f(t.y))/2;return i*r/2}).style("fill",y).style("letter-spacing",A);R.append("textPath").attr("id",function(t){return t.id+"-text"}).attr("class","textpath").attr("xlink:href",function(t){return location.pathname+"#"+t.id}).attr("alignment-baseline","middle").attr("text-anchor","middle").style("height","10px")}t.selectAll(".path").select("path").transition().duration(750).attrTween("d",C(e)).style("fill",x).call(w,function(){v(n),t.selectAll("text").attr("x",function(t){return 0}).attr("dy",function(t){return(f(t.y+t.dy)-f(t.y))/2}).attr("dx",function(t){var n=d(t.x),e=d(t.x+t.dx),i=e-n,r=f(t.y)+(f(t.y+t.dy)-f(t.y))/2;return i*r/2}).style("fill",y).style("letter-spacing",A),t.selectAll(".textpath").text(function(t,n){if(!(t.x<d.domain()[0]||t.x>=d.domain()[1])){var e=d(t.x),i=d(t.x+t.dx),r=i-e,a=f(t.y)+(f(t.y+t.dy)-f(t.y))/2,o=r*a;if(!(o<18)){var s=A(t),u=(t.id.split("-text")[0],t.name.split(":")[1]||"");this.textContent=u;for(var l=15,c=l;c>=9;c--)if(this.style.fontSize=c,this.getComputedTextLength()+(u.length-1)*s<=o)return u}}})})}}function C(t){var n=d3.interpolate(d.domain(),[t.x,t.x+t.dx]),e=d3.interpolate(f.domain(),[t.y,1]),i=d3.interpolate(f.range(),[t.y?20:0,c]);return function(t,r){return r?function(n){return h(t)}:function(r){return d.domain(n(r)),f.domain(e(r)).range(i(r)),h(t)}}}function k(t,e){function i(n){var e=a(n);return t.x0=e.x,t.dx0=e.dx,h(e)}var r=n;void 0!=t.x0&&void 0!=t.dx0||(t.x0=t.x+t.dx/2,t.dx0=0);var a=d3.interpolate({x:t.x0,dx:t.dx0},t);if(0==e){var o=d3.interpolate(d.domain(),[r.x,r.x+r.dx]),s=d3.interpolate(f.domain(),[r.y,1]),u=d3.interpolate(f.range(),[r.y?20:0,c]);return function(t){return d.domain(o(t)),f.domain(s(t)).range(u(t)),i(t)}}return i}function A(t){var n=f(t.y)+(f(t.y+t.dy)-f(t.y))/2;return n>130?0:(130-n)/16}function M(t){t.x0=t.x,t.dx0=t.dx}function w(t,n){var e=0;t.each(function(){++e}).each("end",function(){--e||n.apply(this,arguments)})}function B(t,n){return Math.atan2(n[1]-t[1],n[0]-t[0])}function S(t,n){return Math.sqrt(Math.pow(n[1]-t[1],2)+Math.pow(n[0]-t[0],2))}function R(t){return t*(180/Math.PI)}function D(){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(arguments[0][n]=arguments[t][n]);return arguments[0]}var E=this,P=D({},a,g),T=Math.min(i-e.left-e.right,r-e.top-e.bottom)/2;c!=T&&(c=T,f.range([0,c]),h=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,d(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,d(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,f(t.y))}).outerRadius(function(t){return Math.max(0,f(t.y+t.dy))})),t.each(function(t){if(E.data=t,t){var e=d3.select(this);e.on("mouseover",function(){d3.selectAll(".rotateControl").style("visibility","visible")}).on("mouseout",function(){d3.selectAll(".rotateControl").style("visibility","hidden")});var a=e.selectAll("g").data([0]),p=a.enter().append("g").attr("class","gEnter").attr("transform","rotate(0,"+i/2+","+r/2+") translate("+i/2+","+r/2+")");u=t.count,l=0;var v=b.nodes(t);void 0!=n&&n.bin==t.bin||(n=t),n&&(d.domain([n.x,n.x+n.dx]),f.domain([n.y,1]),f.range([n.y?20:0,c]));var m={viral:{range:["#3D0385","#FFB7DB"],interpolate:"interpolateHcl"},bacterial:{range:["#970015","#FFC886"],interpolate:"interpolateHsl"},fungal:{range:["#3B00AD","#B3FFAB"],interpolate:"interpolateHcl"},phage:{range:["#03553C","#DCFF00"],interpolate:"interpolateHcl"}},g=v[0].children[0].children[v[0].children[0].children.length-1],C=v[0].bin;if(o=d3.scale.linear().domain([.075,g.x+g.dx+.75]).range(m[C].range).interpolate(d3[m[C].interpolate]).clamp(!0),s=d3.hcl(o(.7)).brighter(1),P.pixelFilter)var w=a.selectAll(".path").data(v.filter(function(t){if(P.filter&&!P.filter(t))return!1;var e=Math.max(0,Math.min(2*Math.PI,d(t.x))),i=Math.max(0,Math.min(2*Math.PI,d(t.x+t.dx))),r=i-e,a=Math.max(0,f(t.y+t.dy)),o=r*a;return!!(n&&n.id==t.id||0==a)||o>=1}),function(t){return t.id});else var w=a.selectAll(".path").data(v,function(t){return t.id});w.exit().remove(),a.selectAll(".path").select("path").style("fill",x);var D=w.enter().append("g").attr("class","path");if(D.append("path").attr("d",h).attr("id",function(t){return P.idPrefix+t.id}).style("fill",x).on("click",$).on("mouseover",function(t,n){if(0!=n&&P.mouseover){iobioSunburstTooltipDiv.style("display","block"),iobioSunburstTooltipDiv.transition().duration(200).style("opacity",.9);var e=t.name.split(":")[0],i="<div>Absolute Percent:"+parseInt(t.count/u*1e3)/10+"%</div>";l>0&&(i+="<div>Relative Percent:"+parseInt(t.count/l*1e3)/10+"%</div>"),"no rank"==e?iobioSunburstTooltipDiv.html(t.name.split(":")[1]+" - "+t.count+" read(s)"+i):"species"==t.name.split(":")[0]?iobioSunburstTooltipDiv.html("species:"+t.parent.name.split(":")[1]+"."+t.name.split(":")[1]+" - "+t.count+" read(s)"+i):iobioSunburstTooltipDiv.html(t.name+" - "+t.count+" read(s)"+i).style("left",d3.event.pageX+4+"px").style("text-align","left").style("top",d3.event.pageY-62+"px")}}).on("mouseout",function(t){iobioSunburstTooltipDiv.transition().duration(500).style("opacity",0),iobioSunburstTooltipDiv.transition().delay(500).duration(0).style("display","none")}).each(M),P.text){var T=D.append("text").attr("x",function(t){return 0}).attr("dy",function(t){return(f(t.y+t.dy)-f(t.y))/2}).attr("dx",function(t){var n=d(t.x),e=d(t.x+t.dx),i=e-n,r=f(t.y)+(f(t.y+t.dy)-f(t.y))/2;return i*r/2}).style("fill",y).style("letter-spacing",A);T.append("textPath").attr("id",function(t){return t.id+"-text"}).attr("class","textpath").attr("xlink:href",function(t){return location.pathname+"#"+t.id}).attr("alignment-baseline","middle").attr("text-anchor","middle").style("height","10px")}p.append("image").attr("x",c+5).attr("y",-10).attr("xlink:href","assets/images/rotate.png").attr("width",20).attr("height",20).attr("class","rotateControl").call(d3.behavior.drag().on("drag",function(t){var n=[d3.event.x,d3.event.y],e=[0,0],o=(S(n,e),parseInt(a.attr("transform").split("rotate(")[1].split(",")[0])),s=B(e,n),u=R(s)+o;a.attr("transform","rotate("+u+","+i/2+","+r/2+") translate("+i/2+","+r/2+")")})),p.append("line").attr("x1",0).attr("y1",0).attr("x2",c+5).attr("y1",0).attr("class","rotateControl").style("stroke","#2d8fc1"),a.selectAll(".path").select("path").transition().duration(P.transitionDuration).style("fill",x).attrTween("d",k),a.selectAll(".path").select("text").transition().duration(P.transitionDuration).attr("x",function(t){return 0}).attr("dy",function(t){return(f(t.y+t.dy)-f(t.y))/2}).attr("dx",function(t){var n=d(t.x),e=d(t.x+t.dx),i=e-n,r=f(t.y)+(f(t.y+t.dy)-f(t.y))/2;return i*r/2}).style("fill",y).style("letter-spacing",A),a.selectAll(".path").select(".textpath").transition().duration(P.transitionDuration).text(function(t,n){var e=d(t.x),i=d(t.x+t.dx),r=i-e,a=f(t.y)+(f(t.y+t.dy)-f(t.y))/2,o=r*a-2;if(!(o<18)){var s=(t.id.split("-text")[0],t.name.split(":")[1]||"");this.textContent=s;for(var u=A(t),l=15,c=l;c>=9;c--)if(this.style.fontSize=c,this.getComputedTextLength()+(s.length-1)*u<=o)return s}}),d3.select(E.frameElement).style("height",r+"px")}})}window.iobioSunburstTooltipDiv=d3.select("body").append("div").attr("class","tooltip").style("opacity",1);var n,e={top:25,right:10,bottom:25,left:10},i=200,r=200,a={klass:"",text:!0,click:!0,mouseover:!0,idPrefix:"",transitionDuration:750,pixelFilter:!0},o=d3.scale.category20c(),s="white",u=0,l=0,c=Math.min(i-e.left-e.right,r-e.top-e.bottom)/2,d=d3.scale.linear().range([0,2*Math.PI]),f=d3.scale.sqrt().range([0,c]),h=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,d(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,d(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,f(t.y))}).outerRadius(function(t){return Math.max(0,f(t.y+t.dy))}),p=d3.scale.linear(),b=d3.layout.cumulativePartition().sort(null).value(function(t){return t.count}),v=function(){},m=function(){};return t.clear=function(){n=void 0},t.margin=function(n){return arguments.length?(e=n,t):e},t.width=function(n){return arguments.length?(i=n,t):i},t.height=function(n){return arguments.length?(r=n,t):r},t.x=function(n){return arguments.length?(d=n,t):d},t.y=function(n){return arguments.length?(f=n,t):f},t.color=function(n){return arguments.length?(o=n,t):o},t.click=function(n){return arguments.length?(v=n,t):v},t.clickBefore=function(n){return arguments.length?(m=n,t):m},t};d3.layout.cumulativeHierarchy=function(){function t(r){var o,s=[r],u=[];for(r.depth=0;null!=(o=s.pop());)if(u.push(o),(c=e.call(t,o,o.depth))&&(l=c.length)){for(var l,c,d;--l>=0;)s.push(d=c[l]),d.parent=o,d.depth=o.depth+1;i&&(o.value=+i.call(t,o,o.depth)),o.children=c}else i&&(o.value=+i.call(t,o,o.depth)||0),delete o.children;return a(r,function(t){var e;n&&(e=t.children)&&e.sort(n)}),u}var n=u,e=o,i=s;return t.sort=function(e){return arguments.length?(n=e,t):n},t.children=function(n){return arguments.length?(e=n,t):e},t.value=function(n){return arguments.length?(i=n,t):i},t.revalue=function(n){return i&&(r(n,function(t){t.children&&(t.value=0)}),a(n,function(n){var e;n.children||(n.value=+i.call(t,n,n.depth)||0),(e=n.parent)&&(e.value+=n.value)})),n},t},d3.layout.cumulativePartition=function(){function t(n,e,i,r){var a=n.children;if(n.x=e,n.y=n.depth*r,n.dx=i,n.dy=r,a&&(o=a.length)){var o,s,u,l=-1;for(i=n.value?i/n.value:0;++l<o;)t(s=a[l],e,u=s.value*i,r),e+=u}}function n(t){var e=t.children,i=0;if(e&&(r=e.length))for(var r,a=-1;++a<r;)i=Math.max(i,n(e[a]));return 1+i}function e(e,i){var o=r.call(this,e,i);return t(o[0],0,a[0],a[1]/n(o[0])),o}var r=d3.layout.cumulativeHierarchy(),a=[1,1];return e.size=function(t){return arguments.length?(a=t,e):a},i(e,r)},n.exports=c},{"../lib/t.js":1}]},{},[2]);